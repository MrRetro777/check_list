Архитектура интеграции InfoWatch с MikroTik

Интернет → MikroTik → Mirror Port → InfoWatch DLP → Анализ трафика
                    ↓
            Блокировка нежелательного трафика

 Настройка MikroTik для работы с DLP
Mirroring (SPAN) трафика
text

# Создание mirror-интерфейса для копирования трафика
/interface bridge
add name=dlp-bridge

/interface bridge port
add bridge=dlp-bridge interface=ether1
add bridge=dlp-bridge interface=ether2
add bridge=dlp-bridge interface=ether3

# Настройка mirroring для отправки копии трафика на DLP-сервер
/interface bridge settings
set use-ip-firewall=yes use-ip-firewall-for-pppoe=yes

/tool mirror
add name=dlp-mirror interface=all disabled=no \
    mirror-target=dlp-server-ip target-address=192.168.1.100 \
    target-port=9999 protocol=udp

Альтернативный вариант через Traffic Flow
text

/ip traffic-flow
set enabled=yes interfaces=all
/ip traffic-flow target
add address=192.168.1.100 port=2055 version=9

 Настройка фильтрации для DLP системы
Блокировка нежелательных протоколов передачи данных
text

/ip firewall filter
# Блокировка файлообменников
add chain=forward protocol=tcp dst-port=1214 action=drop comment="Block Kazaa"
add chain=forward protocol=tcp dst-port=411-413 action=drop comment="Block DirectConnect"
add chain=forward protocol=tcp dst-port=4662 action=drop comment="Block eMule"

# Блокировка облачных хранилищ (выборочно)
add chain=forward dst-address=104.16.0.0/12 action=drop comment="Block Dropbox"
add chain=forward dst-address=172.217.0.0/16 action=drop comment="Block Google Drive"

# Блокировка почтовых сервисов вне корпоративной почты
add chain=forward protocol=tcp dst-port=25 dst-address=!192.168.1.50 action=drop comment="Allow only corp mail server"

Интеграция с API InfoWatch
Настройка веб-прокси для фильтрации контента
text

/ip proxy
set enabled=yes port=8080 src-address=0.0.0.0

/ip proxy access
add dst-host=~.* action=allow disabled=no

# Правила для интеграции с DLP
/ip firewall layer7-protocol
add name=social-media regexp="^(facebook|twitter|vk)\\.com"

/ip firewall filter
add chain=forward layer7-protocol=social-media action=drop comment="Block social media by DLP policy"

Настройка QoS для приоритизации DLP трафика
text

/queue tree
add name=dlp-traffic parent=global queue=default priority=1 \
    packet-mark=dlp-mark limit-at=10M max-limit=100M

/ip firewall mangle
add chain=forward dst-address=192.168.1.100 action=mark-packet \
    new-packet-mark=dlp-mark passthrough=no comment="Mark DLP server traffic"

 Мониторинг и логирование для DLP
Детальное логирование сетевой активности
text

/ip firewall filter
add chain=forward action=log log-prefix="DLP-MONITOR" disabled=no

/system logging
add action=remote topics=firewall target=192.168.1.100:514
add action=echo topics=firewall

Настройка Netflow для детального анализа
text

/ip traffic-flow
set enabled=yes cache-entries=4k active-timeout=30m

/ip traffic-flow target
add address=192.168.1.100 port=2055 version=9

 Политики безопасности для разных отделов
Сегментация по VLAN с разными политиками DLP
text

/interface vlan
add name=Management vlan-id=10 interface=bridge
add name=Finance vlan-id=20 interface=bridge
add name=Engineering vlan-id=30 interface=bridge

# Разные политики для разных отделов
/ip firewall filter
add chain=forward src-address=192.168.10.0/24 action=accept comment="Management - full access"
add chain=forward src-address=192.168.20.0/24 protocol=tcp dst-port=25,443,587 action=accept comment="Finance - restricted"
add chain=forward src-address=192.168.20.0/24 action=drop comment="Finance - block other"
Автоматизация реакций на инциденты
Скрипты для автоматической блокировки
text

/system script
add name=block-user source={
    /ip firewall address-list add address="\$userIP" list=dlp-blocked
    /log info "DLP Alert: Blocked user \$userIP"
}

add name=unblock-user source={
    /ip firewall address-list remove [find address="\$userIP" list=dlp-blocked]
    /log info "DLP Alert: Unblocked user \$userIP"
}

Настройка безопасности DLP-канала
Шифрование передачи данных
text

/ip ipsec proposal
add name=dlp-proposal auth-algorithms=sha256 enc-algorithms=aes-256-cbc

/ip ipsec policy
add src-address=192.168.1.0/24 dst-address=192.168.1.100 proposal=dlp-proposal

 Мониторинг эффективности DLP
Сбор статистики
text

/system scheduler
add name=dlp-stats interval=1h on-event={
    /log info "DLP Statistics: [/ip firewall filter get [find comment~\"DLP\"] bytes]"
    /tool traffic-monitor once
}

Для чего была развернута и что установлено   DLP:
    Контроль передачи конфиденциальных данных
    Мониторинг почтовых вложений
    Контроль USB-устройств
    Анализ печати документов
    Мониторинг облачных сервисов
